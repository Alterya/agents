(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{3661:function(e,t,s){Promise.resolve().then(s.bind(s,8795))},8795:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),r=s(2265),i=s(9547),n=s(5694),l=s(9733),o=s(7209),c=s(4919);let d="promptbro:versions";function u(e){let t;let s=/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,a=new Set;for(;null!==(t=s.exec(e));){var r;let e=null===(r=t[1])||void 0===r?void 0:r.trim();e&&a.add(e)}return Array.from(a)}function m(){try{let e=window.localStorage.getItem(d);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];return t.filter(e=>e&&"string"==typeof e.id&&"number"==typeof e.timestamp&&"string"==typeof e.name&&"string"==typeof e.template&&Array.isArray(e.variables))}catch(e){return[]}}function p(e){try{window.localStorage.setItem(d,JSON.stringify(e))}catch(e){}}let h="promptbro:lastDraft";function f(){let[e,t]=(0,r.useState)("openai"),[s,d]=(0,r.useState)("gpt-4o"),[f,v]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[w,S]=(0,r.useState)("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),[k,C]=(0,r.useState)(""),[T,O]=(0,r.useState)([]),[A,I]=(0,r.useState)({}),[z,D]=(0,r.useState)([]),[E,M]=(0,r.useState)(""),[_,R]=(0,r.useState)(""),[U,J]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{let e=await fetch("/api/prompt-templates");e.ok&&O((await e.json()).templates||[])})(),D(m().sort((e,t)=>t.timestamp-e.timestamp));try{let e=window.localStorage.getItem(h);if(e){let t=JSON.parse(e);t&&"object"==typeof t&&"string"==typeof t.name&&"string"==typeof t.description&&"string"==typeof t.template&&(!t.varValues||"object"==typeof t.varValues)&&(b(t.name),N(t.description),S(t.template),t.varValues&&"object"==typeof t.varValues&&I(t.varValues))}}catch(e){}},[]),(0,r.useEffect)(()=>{let e=u(w);C(e.join(", ")),I(t=>{let s={...t};for(let t of e)t in s||(s[t]="");for(let t of Object.keys(s))e.includes(t)||delete s[t];return s})},[w]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{try{window.localStorage.setItem(h,JSON.stringify({name:y,description:j,template:w,varValues:A})),M("Autosaved at ".concat(new Date().toLocaleTimeString(void 0,{hour12:!1})))}catch(e){}},500);return()=>clearTimeout(e)},[y,j,w,A]);let P=async()=>{g(""),R("");let t=[{role:"system",content:"You help refine prompts by asking clarifying questions."},{role:"user",content:f}],a=await fetch("/api/llm/chat",{method:"POST",headers:{"content-type":"application/json","x-assist":"promptbro"},body:JSON.stringify({provider:e,model:s,messages:t,maxTokens:128,temperature:.2})});if(!a.ok){R(429===a.status?"Assist rate limited. Try again shortly.":"Assist failed. Please try again.");return}g((await a.json()).text||"")},V=async()=>{R("");let e=u(w),t=await fetch("/api/prompt-templates",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:y,description:j,template:w,variables:e})});t.ok?O((await (await fetch("/api/prompt-templates")).json()).templates||[]):R(429===t.status?"Save rate limited. Try again later.":"Save failed. Check inputs and try again.")},Z=w?w.replace(/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,(e,t)=>{let s=String(null!=t?t:"").trim(),a=A[s];return"string"==typeof a&&a.length>0?a:"{{".concat(s,"}}")}):"",L=u(w).filter(e=>{var t;return!(null!==(t=A[e])&&void 0!==t?t:"").trim()}),q=e=>{let t=m().find(t=>t.id===e);t&&(b(t.name),N(t.description||""),S(t.template))},B=e=>{p(m().filter(t=>t.id!==e)),D(t=>t.filter(t=>t.id!==e))},Q=async()=>{try{await navigator.clipboard.writeText(Z),J("Assembled prompt copied"),setTimeout(()=>J(""),1500)}catch(e){}},X=async()=>{var e;let t=JSON.stringify({name:(e={name:y||"unnamed",template:w,variables:u(w)}).name,template:e.template,variables:e.variables,exportedAt:new Date().toISOString(),version:1},null,2);try{await navigator.clipboard.writeText(t),J("Template JSON copied"),setTimeout(()=>J(""),1500)}catch(e){}};return(0,a.jsxs)("main",{className:"space-y-4 p-6",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"PromptBro"}),(0,a.jsx)(i.x,{}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(n.U,{provider:e,model:s,onChange:e=>{t(e.provider),d(e.model)}})}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Describe your task"}),_&&(0,a.jsx)("div",{role:"alert",className:"rounded border border-red-600 bg-red-950/40 p-2 text-sm text-red-300",children:_}),U&&(0,a.jsx)("div",{role:"status",className:"rounded border border-emerald-600 bg-emerald-950/40 p-2 text-sm text-emerald-300",children:U}),(0,a.jsx)(c.g,{className:"border",rows:4,value:f,onChange:e=>v(e.target.value),"aria-label":"Describe your task"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:P,children:"Ask clarifying question"}),(0,a.jsx)("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:x})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Draft Template"}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsxs)("label",{children:["Name",(0,a.jsx)(o.I,{className:"ml-2 border",value:y,onChange:e=>b(e.target.value)})]}),(0,a.jsxs)("label",{children:["Description",(0,a.jsx)(o.I,{className:"ml-2 border",value:j,onChange:e=>N(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Derived variables"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[0===Object.keys(A).length&&(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"No variables detected"}),Object.entries(A).map(e=>{let[t,s]=e;return(0,a.jsxs)("label",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"mr-1 font-medium",children:["{{".concat(t,"}}"),":"]}),(0,a.jsx)(o.I,{className:"border",placeholder:"value for ".concat(t),value:s,onChange:e=>I(s=>({...s,[t]:e.target.value}))})]},t)})]})]}),(0,a.jsx)(c.g,{className:"w-full border",rows:10,value:w,onChange:e=>S(e.target.value),"aria-label":"Draft Template"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:V,children:"Save template"}),L.length>0&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:"Missing values for: ".concat(L.join(", "))}),E&&(0,a.jsx)("div",{className:"text-xs text-gray-500",children:E}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:()=>{let e=function(e){var t,s,a,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Math.max(1,null!==(a=i.maxCount)&&void 0!==a?a:10),l={id:null!==(r=null===(s=globalThis.crypto)||void 0===s?void 0:null===(t=s.randomUUID)||void 0===t?void 0:t.call(s))&&void 0!==r?r:"v_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),timestamp:Date.now(),name:e.name,description:e.description,template:e.template,variables:[...e.variables]};return p([l,...m()].slice(0,n)),l}({name:y||"unnamed",description:j,template:w,variables:u(w)});D(t=>[e,...t]),J("Version saved"),setTimeout(()=>J(""),1500)},children:"Save version"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:Q,children:"Copy assembled"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:X,children:"Export JSON"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:()=>{b(""),N(""),S("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),I({});try{window.localStorage.removeItem(h)}catch(e){}},children:"Reset draft"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mt-2 text-base font-medium",children:"Assembled Preview"}),(0,a.jsx)("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:Z})]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Versions"}),(0,a.jsxs)("ul",{className:"list-disc pl-6",children:[0===z.length&&(0,a.jsx)("li",{className:"text-sm text-gray-500",children:"No versions saved"}),z.map(e=>(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)(l.z,{className:"border",size:"sm",variant:"secondary",onClick:()=>q(e.id),children:"Restore"}),(0,a.jsx)(l.z,{className:"border",size:"sm",variant:"secondary",onClick:()=>B(e.id),children:"Delete"})]},e.id))]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Quick Checks"}),(0,a.jsx)(l.z,{className:"border",variant:"secondary",onClick:()=>{let e=function(e){let t=[],s=u(e);e.length>2e4&&t.push({id:"size",severity:"high",message:"Template exceeds size limits",hint:"Reduce length below 20k characters."});let a=e.toLowerCase();a.includes("audience")||a.includes("user")||t.push({id:"audience",severity:"medium",message:"Audience not specified",hint:"Mention who the output is for (e.g., developer, end-user)."}),a.includes("success")||a.includes("criteria")||t.push({id:"success",severity:"medium",message:"Missing success criteria",hint:"Define what a good answer looks like."}),a.includes("format")||a.includes("json")||a.includes("markdown")||t.push({id:"format",severity:"low",message:"Output format not specified",hint:"Ask for JSON, Markdown, or a specific structure."}),/ignore\s+previous|system:|jailbreak/i.test(e)&&t.push({id:"injection",severity:"high",message:"Potential prompt injection markers detected",hint:"Remove instructions that subvert prior rules."}),s.length>0&&t.push({id:"variables",severity:"low",message:"Detected variables: ".concat(s.join(", ")),hint:"Ensure these are provided before running."});let r=100;for(let e of t)"high"===e.severity?r-=30:"medium"===e.severity?r-=15:r-=5;return{issues:t,score:r=Math.max(0,Math.min(100,r))}}(w);e.issues.some(e=>"high"===e.severity)?J("Checks: ".concat(e.issues.length," issues, score ").concat(e.score,"/100")):J("Checks passed with score ".concat(e.score,"/100")),setTimeout(()=>J(""),2e3)},children:"Run Quick Checks"})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Saved Templates"}),(0,a.jsx)("ul",{className:"list-disc pl-6",children:T.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:e.name})," — ",e.description||""]},e.id))})]})]})}},9547:function(e,t,s){"use strict";s.d(t,{x:function(){return i}});var a=s(7437),r=s(2265);function i(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(null);if((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/config/provider-status");if(!e.ok)throw Error("status_failed");let s=await e.json();t(s)}catch(e){i("Unable to load provider status")}})()},[]),s)return(0,a.jsx)("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:s});if(!e)return null;let n=[];return(e.openaiConfigured||n.push("OpenAI"),e.openrouterConfigured||n.push("OpenRouter"),0===n.length)?null:(0,a.jsxs)("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:["Missing provider configuration: ",n.join(", "),". Some features may be limited."]})}},5694:function(e,t,s){"use strict";s.d(t,{U:function(){return i}});var a=s(7437),r=s(2265);function i(e){var t;let{provider:s,model:i,onChange:n}=e,[l,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/config/provider-status");if(!e.ok)throw Error("status_failed");let t=await e.json();o(t)}catch(e){o({openaiConfigured:!1,openrouterConfigured:!1,allowedModels:[]})}})()},[]);let c=(null==l?void 0:null===(t=l.allowedModels)||void 0===t?void 0:t.length)?l.allowedModels:[];return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"space-x-2",children:(0,a.jsxs)("label",{children:["Provider",(0,a.jsxs)("select",{value:s,onChange:e=>n({provider:e.target.value,model:i}),className:"ml-2 border p-1","data-testid":"pms-provider",children:[(0,a.jsx)("option",{value:"openai",children:"openai"}),(0,a.jsx)("option",{value:"openrouter",children:"openrouter"})]})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:["Model",c.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("select",{value:i,onChange:e=>n({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model",children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("input",{type:"hidden",value:i,"data-testid":"pms-model-input",readOnly:!0})]}):(0,a.jsx)("input",{value:i,onChange:e=>n({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model-input"})]})})]})}},9733:function(e,t,s){"use strict";s.d(t,{z:function(){return n}});var a=s(7437),r=s(2265),i=s(4839);let n=r.forwardRef((e,t)=>{let{className:s,variant:r="default",size:n="md",...l}=e;return(0,a.jsx)("button",{ref:t,className:(0,i.Z)("inline-flex items-center justify-center rounded transition-colors disabled:opacity-50 disabled:pointer-events-none","sm"===n&&"px-2 py-1 text-sm","md"===n&&"px-3 py-2 text-sm","lg"===n&&"px-4 py-2 text-base","default"===r&&"bg-blue-600 text-white hover:bg-blue-500","secondary"===r&&"bg-slate-700 text-slate-100 hover:bg-slate-600","ghost"===r&&"bg-transparent text-slate-100 hover:bg-slate-800","destructive"===r&&"bg-red-600 text-white hover:bg-red-500","outline"===r&&"border border-slate-700 text-slate-100 hover:bg-slate-800",s),...l})});n.displayName="Button"},7209:function(e,t,s){"use strict";s.d(t,{I:function(){return n}});var a=s(7437),r=s(2265),i=s(4839);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("input",{ref:t,className:(0,i.Z)("w-full rounded bg-slate-800 px-3 py-2 text-sm outline-none ring-blue-500 focus:ring-2",s),...r})});n.displayName="Input"},4919:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var a=s(7437),r=s(2265),i=s(4839);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{ref:t,className:(0,i.Z)("w-full rounded bg-slate-800 p-2 text-sm outline-none ring-blue-500 focus:ring-2",s),...r})});n.displayName="Textarea"},4839:function(e,t,s){"use strict";t.Z=function(){for(var e,t,s=0,a="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=function e(t){var s,a,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(s=0;s<i;s++)t[s]&&(a=e(t[s]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a)}return r}(e))&&(a&&(a+=" "),a+=t);return a}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3661)}),_N_E=e.O()}]);
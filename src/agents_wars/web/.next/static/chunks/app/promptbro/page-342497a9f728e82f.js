(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{3661:function(e,t,s){Promise.resolve().then(s.bind(s,8795))},8795:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),r=s(2265),i=s(9547),n=s(5694);let l="promptbro:versions";function o(e){let t;let s=/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,a=new Set;for(;null!==(t=s.exec(e));){var r;let e=null===(r=t[1])||void 0===r?void 0:r.trim();e&&a.add(e)}return Array.from(a)}function c(){try{let e=window.localStorage.getItem(l);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];return t.filter(e=>e&&"string"==typeof e.id&&"number"==typeof e.timestamp&&"string"==typeof e.name&&"string"==typeof e.template&&Array.isArray(e.variables))}catch(e){return[]}}function d(e){try{window.localStorage.setItem(l,JSON.stringify(e))}catch(e){}}let m="promptbro:lastDraft";function u(){let[e,t]=(0,r.useState)("openai"),[s,l]=(0,r.useState)("gpt-4o"),[u,p]=(0,r.useState)(""),[h,x]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[b,j]=(0,r.useState)("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),[N,w]=(0,r.useState)(""),[S,k]=(0,r.useState)([]),[C,T]=(0,r.useState)({}),[O,A]=(0,r.useState)([]),[D,E]=(0,r.useState)(""),[M,I]=(0,r.useState)(""),[_,U]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{let e=await fetch("/api/prompt-templates");e.ok&&k((await e.json()).templates||[])})(),A(c().sort((e,t)=>t.timestamp-e.timestamp));try{let e=window.localStorage.getItem(m);if(e){let t=JSON.parse(e);t&&"object"==typeof t&&"string"==typeof t.name&&"string"==typeof t.description&&"string"==typeof t.template&&(!t.varValues||"object"==typeof t.varValues)&&(v(t.name),y(t.description),j(t.template),t.varValues&&"object"==typeof t.varValues&&T(t.varValues))}}catch(e){}},[]),(0,r.useEffect)(()=>{let e=o(b);w(e.join(", ")),T(t=>{let s={...t};for(let t of e)t in s||(s[t]="");for(let t of Object.keys(s))e.includes(t)||delete s[t];return s})},[b]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{try{window.localStorage.setItem(m,JSON.stringify({name:f,description:g,template:b,varValues:C})),E("Autosaved at ".concat(new Date().toLocaleTimeString(void 0,{hour12:!1})))}catch(e){}},500);return()=>clearTimeout(e)},[f,g,b,C]);let J=async()=>{x(""),I("");let t=[{role:"system",content:"You help refine prompts by asking clarifying questions."},{role:"user",content:u}],a=await fetch("/api/llm/chat",{method:"POST",headers:{"content-type":"application/json","x-assist":"promptbro"},body:JSON.stringify({provider:e,model:s,messages:t,maxTokens:128,temperature:.2})});if(!a.ok){I(429===a.status?"Assist rate limited. Try again shortly.":"Assist failed. Please try again.");return}x((await a.json()).text||"")},P=async()=>{I("");let e=o(b),t=await fetch("/api/prompt-templates",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:f,description:g,template:b,variables:e})});t.ok?k((await (await fetch("/api/prompt-templates")).json()).templates||[]):I(429===t.status?"Save rate limited. Try again later.":"Save failed. Check inputs and try again.")},R=b?b.replace(/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,(e,t)=>{let s=String(null!=t?t:"").trim(),a=C[s];return"string"==typeof a&&a.length>0?a:"{{".concat(s,"}}")}):"",V=o(b).filter(e=>{var t;return!(null!==(t=C[e])&&void 0!==t?t:"").trim()}),z=e=>{let t=c().find(t=>t.id===e);t&&(v(t.name),y(t.description||""),j(t.template))},L=e=>{d(c().filter(t=>t.id!==e)),A(t=>t.filter(t=>t.id!==e))},q=async()=>{try{await navigator.clipboard.writeText(R),U("Assembled prompt copied"),setTimeout(()=>U(""),1500)}catch(e){}},Q=async()=>{var e;let t=JSON.stringify({name:(e={name:f||"unnamed",template:b,variables:o(b)}).name,template:e.template,variables:e.variables,exportedAt:new Date().toISOString(),version:1},null,2);try{await navigator.clipboard.writeText(t),U("Template JSON copied"),setTimeout(()=>U(""),1500)}catch(e){}};return(0,a.jsxs)("main",{className:"space-y-4 p-6",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"PromptBro"}),(0,a.jsx)(i.x,{}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(n.U,{provider:e,model:s,onChange:e=>{t(e.provider),l(e.model)}})}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Describe your task"}),M&&(0,a.jsx)("div",{role:"alert",className:"rounded border border-red-600 bg-red-950/40 p-2 text-sm text-red-300",children:M}),_&&(0,a.jsx)("div",{role:"status",className:"rounded border border-emerald-600 bg-emerald-950/40 p-2 text-sm text-emerald-300",children:_}),(0,a.jsx)("textarea",{className:"w-full border p-2",rows:4,value:u,onChange:e=>p(e.target.value),"aria-label":"Describe your task"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:J,children:"Ask clarifying question"}),(0,a.jsx)("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:h})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Draft Template"}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsxs)("label",{children:["Name",(0,a.jsx)("input",{className:"ml-2 border p-1",value:f,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("label",{children:["Description",(0,a.jsx)("input",{className:"ml-2 border p-1",value:g,onChange:e=>y(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Derived variables"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[0===Object.keys(C).length&&(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"No variables detected"}),Object.entries(C).map(e=>{let[t,s]=e;return(0,a.jsxs)("label",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"mr-1 font-medium",children:["{{".concat(t,"}}"),":"]}),(0,a.jsx)("input",{className:"border p-1",placeholder:"value for ".concat(t),value:s,onChange:e=>T(s=>({...s,[t]:e.target.value}))})]},t)})]})]}),(0,a.jsx)("textarea",{className:"w-full border p-2",rows:10,value:b,onChange:e=>j(e.target.value),"aria-label":"Draft Template"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:P,children:"Save template"}),V.length>0&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:"Missing values for: ".concat(V.join(", "))}),D&&(0,a.jsx)("div",{className:"text-xs text-gray-500",children:D}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)("button",{className:"border px-3 py-1",onClick:()=>{let e=function(e){var t,s,a,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Math.max(1,null!==(a=i.maxCount)&&void 0!==a?a:10),l={id:null!==(r=null===(s=globalThis.crypto)||void 0===s?void 0:null===(t=s.randomUUID)||void 0===t?void 0:t.call(s))&&void 0!==r?r:"v_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),timestamp:Date.now(),name:e.name,description:e.description,template:e.template,variables:[...e.variables]};return d([l,...c()].slice(0,n)),l}({name:f||"unnamed",description:g,template:b,variables:o(b)});A(t=>[e,...t]),U("Version saved"),setTimeout(()=>U(""),1500)},children:"Save version"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:q,children:"Copy assembled"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:Q,children:"Export JSON"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:()=>{v(""),y(""),j("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),T({});try{window.localStorage.removeItem(m)}catch(e){}},children:"Reset draft"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mt-2 text-base font-medium",children:"Assembled Preview"}),(0,a.jsx)("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:R})]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Versions"}),(0,a.jsxs)("ul",{className:"list-disc pl-6",children:[0===O.length&&(0,a.jsx)("li",{className:"text-sm text-gray-500",children:"No versions saved"}),O.map(e=>(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)("button",{className:"border px-2 py-0.5",onClick:()=>z(e.id),children:"Restore"}),(0,a.jsx)("button",{className:"border px-2 py-0.5",onClick:()=>L(e.id),children:"Delete"})]},e.id))]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Quick Checks"}),(0,a.jsx)("button",{className:"border px-3 py-1",onClick:()=>{let e=function(e){let t=[],s=o(e);e.length>2e4&&t.push({id:"size",severity:"high",message:"Template exceeds size limits",hint:"Reduce length below 20k characters."});let a=e.toLowerCase();a.includes("audience")||a.includes("user")||t.push({id:"audience",severity:"medium",message:"Audience not specified",hint:"Mention who the output is for (e.g., developer, end-user)."}),a.includes("success")||a.includes("criteria")||t.push({id:"success",severity:"medium",message:"Missing success criteria",hint:"Define what a good answer looks like."}),a.includes("format")||a.includes("json")||a.includes("markdown")||t.push({id:"format",severity:"low",message:"Output format not specified",hint:"Ask for JSON, Markdown, or a specific structure."}),/ignore\s+previous|system:|jailbreak/i.test(e)&&t.push({id:"injection",severity:"high",message:"Potential prompt injection markers detected",hint:"Remove instructions that subvert prior rules."}),s.length>0&&t.push({id:"variables",severity:"low",message:"Detected variables: ".concat(s.join(", ")),hint:"Ensure these are provided before running."});let r=100;for(let e of t)"high"===e.severity?r-=30:"medium"===e.severity?r-=15:r-=5;return{issues:t,score:r=Math.max(0,Math.min(100,r))}}(b);e.issues.some(e=>"high"===e.severity)?U("Checks: ".concat(e.issues.length," issues, score ").concat(e.score,"/100")):U("Checks passed with score ".concat(e.score,"/100")),setTimeout(()=>U(""),2e3)},children:"Run Quick Checks"})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Saved Templates"}),(0,a.jsx)("ul",{className:"list-disc pl-6",children:S.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:e.name})," â€” ",e.description||""]},e.id))})]})]})}},9547:function(e,t,s){"use strict";s.d(t,{x:function(){return i}});var a=s(7437),r=s(2265);function i(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(null);if((0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/config/provider-status");if(!e.ok)throw Error("status_failed");let s=await e.json();t(s)}catch(e){i("Unable to load provider status")}})()},[]),s)return(0,a.jsx)("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:s});if(!e)return null;let n=[];return(e.openaiConfigured||n.push("OpenAI"),e.openrouterConfigured||n.push("OpenRouter"),0===n.length)?null:(0,a.jsxs)("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:["Missing provider configuration: ",n.join(", "),". Some features may be limited."]})}},5694:function(e,t,s){"use strict";s.d(t,{U:function(){return i}});var a=s(7437),r=s(2265);function i(e){var t;let{provider:s,model:i,onChange:n}=e,[l,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/config/provider-status");if(!e.ok)throw Error("status_failed");let t=await e.json();o(t)}catch(e){o({openaiConfigured:!1,openrouterConfigured:!1,allowedModels:[]})}})()},[]);let c=(null==l?void 0:null===(t=l.allowedModels)||void 0===t?void 0:t.length)?l.allowedModels:[];return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"space-x-2",children:(0,a.jsxs)("label",{children:["Provider",(0,a.jsxs)("select",{value:s,onChange:e=>n({provider:e.target.value,model:i}),className:"ml-2 border p-1","data-testid":"pms-provider",children:[(0,a.jsx)("option",{value:"openai",children:"openai"}),(0,a.jsx)("option",{value:"openrouter",children:"openrouter"})]})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:["Model",c.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("select",{value:i,onChange:e=>n({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model",children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("input",{type:"hidden",value:i,"data-testid":"pms-model-input",readOnly:!0})]}):(0,a.jsx)("input",{value:i,onChange:e=>n({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model-input"})]})})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3661)}),_N_E=e.O()}]);
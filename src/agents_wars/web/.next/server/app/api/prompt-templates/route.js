"use strict";(()=>{var e={};e.id=68,e.ids=[68],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6126:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>A,requestAsyncStorage:()=>f,routeModule:()=>_,serverHooks:()=>O,staticGenerationAsyncStorage:()=>M});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>E});var a=r(9303),i=r(8716),o=r(670),s=r(7410),p=r(3538);async function l(e){return p._.promptTemplate.upsert({where:{name:e.name},update:{description:e.description,template:e.template,variables:e.variables},create:{name:e.name,description:e.description,template:e.template,variables:e.variables}})}async function m(){return p._.promptTemplate.findMany({orderBy:{createdAt:"desc"}})}var u=r(8907);async function d(){return new Response(JSON.stringify({templates:await m()}),{status:200,headers:{"content-type":"application/json"}})}let c=s.z.object({name:s.z.string().trim().min(1).max(120),description:s.z.string().trim().max(1e3).optional(),template:s.z.string().trim().min(1).max(2e4),variables:s.z.array(s.z.string().trim().min(1)).max(100).default([])});async function E(e){try{let t=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||"local";try{(0,u.hb)(`ip:${t}:prompt-template`)}catch(e){if(e instanceof u.Mh)return new Response(JSON.stringify({error:"rate_limited"}),{status:429,headers:{"content-type":"application/json"}});throw e}let r=await e.json(),n=c.safeParse(r);if(!n.success)return new Response(JSON.stringify({error:"invalid_body",details:n.error.flatten()}),{status:400,headers:{"content-type":"application/json"}});let a=await l(n.data);return new Response(JSON.stringify({template:a}),{status:200,headers:{"content-type":"application/json"}})}catch{return new Response(JSON.stringify({error:"internal_error"}),{status:500,headers:{"content-type":"application/json"}})}}let _=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/prompt-templates/route",pathname:"/api/prompt-templates",filename:"route",bundlePath:"app/api/prompt-templates/route"},resolvedPagePath:"/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/api/prompt-templates/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:M,serverHooks:O}=_,R="/api/prompt-templates/route";function A(){return(0,o.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:M})}},5844:(e,t,r)=>{let n;r.d(t,{i:()=>s});var a=r(7410);let i=e=>a.z.preprocess(e=>"string"==typeof e&&0===e.trim().length?void 0:e,e.optional()),o=a.z.object({OPENAI_API_KEY:i(a.z.string().trim().min(1)),OPENROUTER_API_KEY:i(a.z.string().trim().min(1)),OPENROUTER_SITE:i(a.z.string().trim()),ALLOWED_MODELS:i(a.z.string().trim()),SUMMARIZER_MODEL:i(a.z.string().trim()),MAX_TOKENS_PER_CALL:a.z.coerce.number().int().positive().default(512),MAX_MESSAGES_PER_CONVO:a.z.coerce.number().int().positive().default(25),RATE_LIMIT_ENABLED:a.z.union([a.z.string(),a.z.boolean()]).transform(e=>"string"==typeof e?"false"!==e.toLowerCase():!!e).default(!0),RATE_LIMIT_RPM:a.z.coerce.number().int().positive().default(60),REQUEST_TIMEOUT_MS:a.z.coerce.number().int().positive().default(6e4),MAX_USD_PER_CONVO:a.z.coerce.number().nonnegative().optional()}).refine(e=>!!(e.OPENAI_API_KEY||e.OPENROUTER_API_KEY),"At least one provider key must be set: OPENAI_API_KEY or OPENROUTER_API_KEY");function s(){if(n)return n;let e={...process.env},t=o.parse(e);return n={openaiApiKey:t.OPENAI_API_KEY||void 0,openrouterApiKey:t.OPENROUTER_API_KEY||void 0,openrouterSite:t.OPENROUTER_SITE||void 0,allowedModels:t.ALLOWED_MODELS?t.ALLOWED_MODELS.split(",").map(e=>e.trim()).filter(Boolean):[],summarizerModel:t.SUMMARIZER_MODEL||void 0,maxTokensPerCall:t.MAX_TOKENS_PER_CALL,maxMessagesPerConversation:t.MAX_MESSAGES_PER_CONVO,rateLimitEnabled:t.RATE_LIMIT_ENABLED,rateLimitRpm:t.RATE_LIMIT_RPM,requestTimeoutMs:t.REQUEST_TIMEOUT_MS,maxUsdPerConversation:t.MAX_USD_PER_CONVO,redisUrl:e.REDIS_URL||void 0}}},8907:(e,t,r)=>{r.d(t,{Mh:()=>a,Ow:()=>l,Sv:()=>i,_v:()=>p,hb:()=>s});var n=r(5844);class a extends Error{constructor(e){super(e),this.name="GuardrailsError"}}function i(e){let t=(0,n.i)().maxTokensPerCall;if((e.requestedMaxTokens??t)>t)throw new a(`maxTokens exceeds cap (${e.requestedMaxTokens} > ${t})`);let r=(0,n.i)().maxMessagesPerConversation;if(e.messageCount>r)throw new a(`message count exceeds cap (${e.messageCount} > ${r})`);let i=new Set((0,n.i)().allowedModels);if(i.size>0&&!i.has(e.model))throw new a(`model not allowed: ${e.model}`)}let o=new Map;function s(e){let t=(0,n.i)();if(!t.rateLimitEnabled)return;let r=t.rateLimitRpm,i=Date.now(),s=o.get(e);if(!s||i-s.windowStartMs>=6e4){o.set(e,{count:1,windowStartMs:i});return}if(s.count>=r)throw new a("rate limit exceeded");s.count+=1}async function p(e){await new Promise(t=>setTimeout(t,e))}function l(e){return 250+500*e+Math.floor(100*Math.random())}},3538:(e,t,r)=>{r.d(t,{_:()=>a});var n=r(3524);let a=global.prisma??new n.PrismaClient({log:["error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,691],()=>r(6126));module.exports=n})();
(()=>{var e={};e.id=850,e.ids=[850],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6295:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c}),t(9921),t(1506),t(5866);var a=t(3191),r=t(8716),i=t(7922),n=t.n(i),l=t(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let c=["",{children:["promptbro",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9921)),"/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/promptbro/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1506)),"/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/promptbro/page.tsx"],m="/promptbro/page",p={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/promptbro/page",pathname:"/promptbro",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8135:()=>{},2715:(e,s,t)=>{Promise.resolve().then(t.bind(t,9871))},8627:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},9871:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var a=t(326),r=t(7577),i=t(7137),n=t(5360);function l(e){let s;let t=/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,a=new Set;for(;null!==(s=t.exec(e));){let e=s[1]?.trim();e&&a.add(e)}return Array.from(a)}function o(){let[e,s]=(0,r.useState)("openai"),[t,o]=(0,r.useState)("gpt-4o"),[c,d]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[b,v]=(0,r.useState)("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),[j,y]=(0,r.useState)(""),[f,N]=(0,r.useState)([]),[w,S]=(0,r.useState)({}),[k,C]=(0,r.useState)([]),[P,T]=(0,r.useState)(""),[_,O]=(0,r.useState)(""),[A,M]=(0,r.useState)(""),D=async()=>{p(""),O("");let s=[{role:"system",content:"You help refine prompts by asking clarifying questions."},{role:"user",content:c}],a=await fetch("/api/llm/chat",{method:"POST",headers:{"content-type":"application/json","x-assist":"promptbro"},body:JSON.stringify({provider:e,model:t,messages:s,maxTokens:128,temperature:.2})});if(!a.ok){O(429===a.status?"Assist rate limited. Try again shortly.":"Assist failed. Please try again.");return}p((await a.json()).text||"")},U=async()=>{O("");let e=l(b),s=await fetch("/api/prompt-templates",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:u,description:x,template:b,variables:e})});s.ok?N((await (await fetch("/api/prompt-templates")).json()).templates||[]):O(429===s.status?"Save rate limited. Try again later.":"Save failed. Check inputs and try again.")},q=b?b.replace(/\{\{\s*([a-zA-Z0-9_-]+)\s*\}\}/g,(e,s)=>{let t=String(s??"").trim(),a=w[t];return"string"==typeof a&&a.length>0?a:`{{${t}}}`}):"",$=l(b).filter(e=>!(w[e]??"").trim()),R=e=>{let s=[].find(s=>s.id===e);s&&(h(s.name),g(s.description||""),v(s.template))},E=e=>{[].filter(s=>s.id!==e),C(s=>s.filter(s=>s.id!==e))},I=async()=>{try{await navigator.clipboard.writeText(q),M("Assembled prompt copied"),setTimeout(()=>M(""),1500)}catch{}},J=async()=>{var e;let s=JSON.stringify({name:(e={name:u||"unnamed",template:b,variables:l(b)}).name,template:e.template,variables:e.variables,exportedAt:new Date().toISOString(),version:1},null,2);try{await navigator.clipboard.writeText(s),M("Template JSON copied"),setTimeout(()=>M(""),1500)}catch{}};return(0,a.jsxs)("main",{className:"space-y-4 p-6",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"PromptBro"}),a.jsx(i.x,{}),a.jsx("div",{className:"space-y-2",children:a.jsx(n.U,{provider:e,model:t,onChange:e=>{s(e.provider),o(e.model)}})}),(0,a.jsxs)("section",{className:"space-y-2",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Describe your task"}),_&&a.jsx("div",{role:"alert",className:"rounded border border-red-600 bg-red-950/40 p-2 text-sm text-red-300",children:_}),A&&a.jsx("div",{role:"status",className:"rounded border border-emerald-600 bg-emerald-950/40 p-2 text-sm text-emerald-300",children:A}),a.jsx("textarea",{className:"w-full border p-2",rows:4,value:c,onChange:e=>d(e.target.value),"aria-label":"Describe your task"}),a.jsx("button",{className:"border px-3 py-1",onClick:D,children:"Ask clarifying question"}),a.jsx("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:m})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Draft Template"}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsxs)("label",{children:["Name",a.jsx("input",{className:"ml-2 border p-1",value:u,onChange:e=>h(e.target.value)})]}),(0,a.jsxs)("label",{children:["Description",a.jsx("input",{className:"ml-2 border p-1",value:x,onChange:e=>g(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Derived variables"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[0===Object.keys(w).length&&a.jsx("span",{className:"text-sm text-gray-500",children:"No variables detected"}),Object.entries(w).map(([e,s])=>(0,a.jsxs)("label",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"mr-1 font-medium",children:[`{{${e}}}`,":"]}),a.jsx("input",{className:"border p-1",placeholder:`value for ${e}`,value:s,onChange:s=>S(t=>({...t,[e]:s.target.value}))})]},e))]})]}),a.jsx("textarea",{className:"w-full border p-2",rows:10,value:b,onChange:e=>v(e.target.value),"aria-label":"Draft Template"}),a.jsx("button",{className:"border px-3 py-1",onClick:U,children:"Save template"}),$.length>0&&a.jsx("div",{className:"text-sm text-red-600",children:`Missing values for: ${$.join(", ")}`}),P&&a.jsx("div",{className:"text-xs text-gray-500",children:P}),(0,a.jsxs)("div",{className:"space-x-2",children:[a.jsx("button",{className:"border px-3 py-1",onClick:()=>{let e=function(e,s={}){let t=Math.max(1,s.maxCount??10),a={id:globalThis.crypto?.randomUUID?.()??`v_${Date.now()}_${Math.random().toString(36).slice(2)}`,timestamp:Date.now(),name:e.name,description:e.description,template:e.template,variables:[...e.variables]};return[a].slice(0,t),a}({name:u||"unnamed",description:x,template:b,variables:l(b)});C(s=>[e,...s]),M("Version saved"),setTimeout(()=>M(""),1500)},children:"Save version"}),a.jsx("button",{className:"border px-3 py-1",onClick:I,children:"Copy assembled"}),a.jsx("button",{className:"border px-3 py-1",onClick:J,children:"Export JSON"}),a.jsx("button",{className:"border px-3 py-1",onClick:()=>{h(""),g(""),v("### INSTRUCTION\n<write here>\n\n### CONTEXT\n<write here>\n\n### OUTPUT\n<write here>"),S({});try{window.localStorage.removeItem("promptbro:lastDraft")}catch{}},children:"Reset draft"})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"mt-2 text-base font-medium",children:"Assembled Preview"}),a.jsx("pre",{className:"min-h-24 whitespace-pre-wrap break-words border p-2",children:q})]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Versions"}),(0,a.jsxs)("ul",{className:"list-disc pl-6",children:[0===k.length&&a.jsx("li",{className:"text-sm text-gray-500",children:"No versions saved"}),k.map(e=>(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"font-medium",children:e.name}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()}),a.jsx("button",{className:"border px-2 py-0.5",onClick:()=>R(e.id),children:"Restore"}),a.jsx("button",{className:"border px-2 py-0.5",onClick:()=>E(e.id),children:"Delete"})]},e.id))]})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Quick Checks"}),a.jsx("button",{className:"border px-3 py-1",onClick:()=>{let e=function(e){let s=[],t=l(e);e.length>2e4&&s.push({id:"size",severity:"high",message:"Template exceeds size limits",hint:"Reduce length below 20k characters."});let a=e.toLowerCase();a.includes("audience")||a.includes("user")||s.push({id:"audience",severity:"medium",message:"Audience not specified",hint:"Mention who the output is for (e.g., developer, end-user)."}),a.includes("success")||a.includes("criteria")||s.push({id:"success",severity:"medium",message:"Missing success criteria",hint:"Define what a good answer looks like."}),a.includes("format")||a.includes("json")||a.includes("markdown")||s.push({id:"format",severity:"low",message:"Output format not specified",hint:"Ask for JSON, Markdown, or a specific structure."}),/ignore\s+previous|system:|jailbreak/i.test(e)&&s.push({id:"injection",severity:"high",message:"Potential prompt injection markers detected",hint:"Remove instructions that subvert prior rules."}),t.length>0&&s.push({id:"variables",severity:"low",message:`Detected variables: ${t.join(", ")}`,hint:"Ensure these are provided before running."});let r=100;for(let e of s)"high"===e.severity?r-=30:"medium"===e.severity?r-=15:r-=5;return{issues:s,score:r=Math.max(0,Math.min(100,r))}}(b);e.issues.some(e=>"high"===e.severity)?M(`Checks: ${e.issues.length} issues, score ${e.score}/100`):M(`Checks passed with score ${e.score}/100`),setTimeout(()=>M(""),2e3)},children:"Run Quick Checks"})]}),(0,a.jsxs)("section",{className:"space-y-2",children:[a.jsx("h2",{className:"text-lg font-medium",children:"Saved Templates"}),a.jsx("ul",{className:"list-disc pl-6",children:f.map(e=>(0,a.jsxs)("li",{children:[a.jsx("span",{className:"font-medium",children:e.name})," â€” ",e.description||""]},e.id))})]})]})}},7137:(e,s,t)=>{"use strict";t.d(s,{x:()=>i});var a=t(326),r=t(7577);function i(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)(null);if(t)return a.jsx("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:t});if(!e)return null;let n=[];return(e.openaiConfigured||n.push("OpenAI"),e.openrouterConfigured||n.push("OpenRouter"),0===n.length)?null:(0,a.jsxs)("div",{className:"border bg-yellow-50 p-2 text-sm text-yellow-800",children:["Missing provider configuration: ",n.join(", "),". Some features may be limited."]})}},5360:(e,s,t)=>{"use strict";t.d(s,{U:()=>i});var a=t(326),r=t(7577);function i(e){let{provider:s,model:t,onChange:i}=e,[n,l]=(0,r.useState)(null),o=n?.allowedModels?.length?n.allowedModels:[];return(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"space-x-2",children:(0,a.jsxs)("label",{children:["Provider",(0,a.jsxs)("select",{value:s,onChange:e=>i({provider:e.target.value,model:t}),className:"ml-2 border p-1","data-testid":"pms-provider",children:[a.jsx("option",{value:"openai",children:"openai"}),a.jsx("option",{value:"openrouter",children:"openrouter"})]})]})}),a.jsx("div",{children:(0,a.jsxs)("label",{children:["Model",o.length>0?(0,a.jsxs)(a.Fragment,{children:[a.jsx("select",{value:t,onChange:e=>i({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model",children:o.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("input",{type:"hidden",value:t,"data-testid":"pms-model-input",readOnly:!0})]}):a.jsx("input",{value:t,onChange:e=>i({provider:s,model:e.target.value}),className:"ml-2 border p-1","data-testid":"pms-model-input"})]})})]})}},1506:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i,metadata:()=>r});var a=t(9510);t(7272);let r={title:"Agent Wars",description:"Agent Wars web app"};function i({children:e}){return(0,a.jsxs)("html",{lang:"en",children:[a.jsx("head",{}),a.jsx("body",{className:"bg-slate-950 text-slate-100",children:e})]})}},9921:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var a=t(8570);let r=(0,a.createProxy)(String.raw`/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/promptbro/page.tsx`),{__esModule:i,$$typeof:n}=r;r.default;let l=(0,a.createProxy)(String.raw`/Users/baramsalem/agents-repo/agents/src/agents_wars/web/app/promptbro/page.tsx#default`)},7272:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[948,471],()=>t(6295));module.exports=a})();